"0","TP2_graph <- function(df, titre, source, display_box = F){"
"0","  "
"0","  ## Librairies"
"0","  library(tidyverse)"
"0","  library(tidyr)"
"0","  library(ggplot2)"
"0","  library(ggthemes)"
"0","  "
"0","  ## Pays de l'Afrique de l'Ouest"
"0","  WAfrica = c(""Benin"",""Burkina Faso"",""Cabo Verde"",""Côte d'Ivoire"",""Gambia"", "
"0","          ""Guinea"",""Guinea-Bissau"",""Mali"",""Mauritania"",""Niger"",""Nigeria"","
"0","          ""Senegal"",""Sierra Leone"",""Togo"")"
"0","  "
"0","  ## Zones géographiques pour le tracé des graphes"
"0","  countries = c(""Niger"", ""Western Africa"", ""World"")"
"0",""
"0","  ## Transformer la base avec la fonction update"
"0","  df = update(df)"
"0","  "
"0","  ## Reconstruire la base"
"0","  df = rebase(df)"
"0","  "
"0","  ## Ajout des statistiques moyennes dans le monde"
"0","  lineWorld = colMeans(df[-1], na.rm = T)"
"0","  df[dim(df)[1]+1,1] = ""World"""
"0","  df[dim(df)[1],2:dim(df)[2]] = lineWorld"
"0",""
"0","  ## Ajout des statistiques moyennes dans l'Afrique de l'Ouest"
"0","  lineWAfrica = colMeans((df |> filter(region %in% WAfrica))[-1], na.rm = T)"
"0","  df[dim(df)[1]+1,1] = ""Western Africa"""
"0","  df[dim(df)[1],2:dim(df)[2]] = lineWAfrica"
"0",""
"0","  ## Filtrer les zones pour les courbes"
"0","  new_df = df %>% filter(region%in%countries)"
"0","  "
"0","  ## Transformation de la base en format long"
"0","  new_df = gather(new_df,key = ""year"", value = ""Value"", -region)"
"0","  "
"0","  ## Convertir la variable année en numérique"
"0","  new_df$year = as.numeric(new_df$year)"
"0","  "
"0","  ## Trier selon l'année"
"0","  new_df <- new_df[order(new_df$year), ]"
"0","  "
"0","  ## Courbes"
"0","  plot <- ggplot(new_df, mapping = aes(x = year, y = Value, col = region)) +"
"0","  geom_line(size = 0.8, show.legend = F) + theme_bw() + geom_point() + "
"0","  scale_x_continuous(n.breaks = 6) + "
"0","  labs("
"0","    title = paste(""Figure : "",titre),"
"0","    x = """", y = """", caption = paste(""Source : "",source), colour = """","
"0","  ) + theme_excel_new() + scale_color_manual(values = c(""#8A8AFF"",""#858585"",""#D5D5D5"")) +"
"0","  theme("
"0","    panel.grid.major.y = element_line(linetype = 'dashed', size = 0.4, color = ""#C0C0C0""),"
"0","    panel.grid.major.x = element_line(linetype = 'solid', size = 0.4, color = ""#C0C0C0""),"
"0","    plot.title = element_text(hjust=0, size = 10, color = ""#0F4761"", face = ""italic""),"
"0","    plot.caption = element_text(hjust=0, size = 8, color = ""black""),"
"0","    legend.position = 'top', legend.justification = 'left'"
"0","  )"
"0","  "
"0","  ## Ajout de la bulle narrative"
"0","  if (display_box == T){"
"0","    label_data <- data.frame("
"0","      x = 2002,"
"0","      y = 0.4,"
"0","      label = ""World: """
"0","    )"
"0","    plot = plot + "
"0","      geom_rect(aes(xmin = 2002 - 2, xmax = 2002 + 2, ymin = 0.4 + 0.07, ymax = 0.4 + 0.1),"
"0","            fill = ""#D5D5D5"", color = NA, shadow = 2,"
"0","            alpha = 0.8, show.legend = F) +"
"0","      geom_text(data = label_data,"
"0","            aes(label = paste(label,0.4), x = x, y = y+0.085), size = 4, colour = ""black"") +"
"0","      annotate(""polygon"","
"0","         x = c(2002 - 0.3, 2002 + 0.3, 2002),"
"0","         y = c(0.4 + 0.07, 0.4 + 0.07, 0.4 + 0.05),"
"0","         fill = ""#D5D5D5"","
"0","         alpha = 0.8)"
"0","  }"
"0","  return(plot)"
"0","}"
